<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Rolling EPA Graph • cfbfastR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Rolling EPA Graph">
<meta name="description" content="&lt;strong&gt;IT'S GRAPHIN' TIME&lt;/strong&gt;&lt;br&gt; ^&lt;em&gt;To be said in an extremely Power Rangers voice&lt;em&gt;^">
<meta property="og:description" content="&lt;strong&gt;IT'S GRAPHIN' TIME&lt;/strong&gt;&lt;br&gt; ^&lt;em&gt;To be said in an extremely Power Rangers voice&lt;em&gt;^">
<meta property="og:image" content="https://github.com/sportsdataverse/cfbfastR-data/blob/main/themes/social_card_cfbfastR_final_quote.png?raw=true">
<meta property="og:image:alt" content="When you code good, you know good. When you know good, you win good. When you win good, they pay good.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@cfbnate">
<meta name="twitter:site" content="@cfbfastR">
<script defer data-domain="cfbfastr.sportsdataverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cfbfastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.9.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" title="cfbfastR"><span class="fa fas fa-home"></span> </a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-funcs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-code"></span> Funcs</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-funcs">
<li><a class="dropdown-item" href="../reference/index.html">Function Index</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>cfbfastR Data</h6></li>
    <li><a class="dropdown-item" href="../reference/load_cfb_pbp.html">Load Full Season PBP Data</a></li>
    <li><a class="dropdown-item" href="../reference/update_cfb_db.html">Update or Create Database</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_pbp_data.html">Play-by-Play Data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CFB Data</h6></li>
    <li><a class="dropdown-item" href="../reference/register_cfbd.html">CFBD API Keys</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_games.html">Games</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_play.html">Plays</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_drives.html">Drives</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_teams.html">Teams</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_players.html">Players</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_stats.html">Statistics</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_metrics.html">Metrics</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_ratings.html">Ratings</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_draft.html">Draft</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_betting_lines.html">Betting</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_recruiting.html">Recruiting</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_coaches.html">Coaches</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_conferences.html">Conferences</a></li>
    <li><a class="dropdown-item" href="../reference/cfbd_venues.html">Venues</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ESPN Data</h6></li>
    <li><a class="dropdown-item" href="../reference/espn_metrics.html">ESPN Metrics</a></li>
    <li><a class="dropdown-item" href="../reference/espn_ratings_fpi.html">ESPN Ratings</a></li>
    <li><a class="dropdown-item" href="../reference/espn_cfb_scoreboard.html">ESPN Scoreboard</a></li>
    <li><a class="dropdown-item" href="../reference/espn_cfb_pbp.html">ESPN PBP</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book-reader"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/index.html">Vignettes</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introductory</h6></li>
    <li><a class="dropdown-item" href="../articles/intro.html">CFB Analytics with cfbfastR</a></li>
    <li><a class="dropdown-item" href="../articles/animated-wp-plotting.html">Animated Win Probability Plots</a></li>
    <li><a class="dropdown-item" href="../articles/fourth-down-plot-tutorial.html">Fourth Down Tendency Plots</a></li>
    <li><a class="dropdown-item" href="../articles/rolling-epa-graph.html">Rolling EPA Graphs</a></li>
    <li><a class="dropdown-item" href="../articles/nth-rated-recruit.html">Visualizing Team Talent with Player Recruit Rankings</a></li>
    <li><a class="dropdown-item" href="../articles/map-tutorial.html">Intro to Visualizing Recruiting Geography</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Expected Points Model Fundamentals</h6></li>
    <li><a class="dropdown-item" href="../articles/college-football-expected-points-model-fundamentals-part-i.html">Part 1 - Model Definition</a></li>
    <li><a class="dropdown-item" href="../articles/college-football-expected-points-model-fundamentals-part-ii.html">Part 2 - Regression Models</a></li>
    <li><a class="dropdown-item" href="../articles/college-football-expected-points-model-fundamentals-part-iii.html">Part 3 - History of Expected Points Models</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>CFBD Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/cfbd_betting.html">CFBD Betting</a></li>
    <li><a class="dropdown-item" href="../articles/cfbd_games.html">CFBD Games</a></li>
    <li><a class="dropdown-item" href="../articles/cfbd_plays.html">CFBD Plays</a></li>
    <li><a class="dropdown-item" href="../articles/cfbd_recruiting.html">CFBD Recruiting</a></li>
    <li><a class="dropdown-item" href="../articles/cfbd_stats.html">CFBD Stats</a></li>
    <li><a class="dropdown-item" href="../articles/cfbd_teams.html">CFBD Teams</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-newspaper"></span>  News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown--sdv" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-project-diagram"></span>  SDV</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown--sdv">
<li><a class="external-link dropdown-item" href="https://sportsdataverse.org/">SportsDataverse</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>R Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://r.sportsdataverse.org/">sportsdataverse-R</a></li>
    <li><a class="dropdown-item" href="https://cfbfastR.sportsdataverse.org/">cfbfastR</a></li>
    <li><a class="external-link dropdown-item" href="https://hoopR.sportsdataverse.org/">hoopR</a></li>
    <li><a class="external-link dropdown-item" href="https://wehoop.sportsdataverse.org/">wehoop</a></li>
    <li><a class="external-link dropdown-item" href="https://fastRhockey.sportsdataverse.org/">fastRhockey</a></li>
    <li><a class="external-link dropdown-item" href="https://hockeyr.netlify.app/">hockeyR</a></li>
    <li><a class="external-link dropdown-item" href="https://abhiamishra.github.io/ggshakeR/">ggshakeR</a></li>
    <li><a class="external-link dropdown-item" href="https://BillPetti.github.io/baseballr/">baseballr</a></li>
    <li><a class="external-link dropdown-item" href="https://jaseziv.github.io/worldfootballR/">worldfootballR</a></li>
    <li><a class="external-link dropdown-item" href="https://usfootballR.sportsdataverse.org/">usfootballR</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/Dato-Futbol/soccerAnimate/">soccerAnimate</a></li>
    <li><a class="external-link dropdown-item" href="https://jaseziv.github.io/chessR/">chessR</a></li>
    <li><a class="external-link dropdown-item" href="https://oddsapiR.sportsdataverse.org/">oddsapiR</a></li>
    <li><a class="external-link dropdown-item" href="https://sportyR.sportsdataverse.org/">sportyR</a></li>
    <li><a class="external-link dropdown-item" href="https://torvik.dev/">toRvik</a></li>
    <li><a class="external-link dropdown-item" href="https://cfbplotR.sportsdataverse.org/">cfbplotR</a></li>
    <li><a class="external-link dropdown-item" href="https://camdenk.github.io/mlbplotR/">mlbplotR</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/sportsdataverse/softballR/">softballR</a></li>
    <li><a class="external-link dropdown-item" href="https://cfb4th.sportsdataverse.org/">cfb4th</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nwslR/nwslR/">nwslR</a></li>
    <li><a class="external-link dropdown-item" href="https://jacklich10.github.io/gamezoneR/">gamezoneR</a></li>
    <li><a class="external-link dropdown-item" href="https://recruitr.sportsdataverse.org/">recruitR</a></li>
    <li><a class="external-link dropdown-item" href="https://puntalytics.github.io/puntr/">puntr</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Python Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://py.sportsdataverse.org/">sportsdataverse-py</a></li>
    <li><a class="external-link dropdown-item" href="https://sportypy.sportsdataverse.org/">sportypy</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nwslR/nwslpy/">nwslpy</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/sportsdataverse/recruitR-py/">recruitR-py</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nathanblumenfeld/collegebaseball/">collegebaseball</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Node.js Packages</h6></li>
    <li><a class="external-link dropdown-item" href="https://js.sportsdataverse.org/">sportsdataverse.js</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/nntrn/nfl-nerd/">nfl-nerd</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown--data" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-database"></span>  Data</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown--data">
<li><a class="external-link dropdown-item" href="https://collegefootballdata.com">CFBData.com</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/sportsdataverse/sportsdataverse-data/releases">SDV Data Releases</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/sportsdataverse/cfbfastR-data">Data Repository</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/sportsdataverse/cfbfastR-raw">Raw Data Repository</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="http://gameonpaper.com/cfb"><span class="fa fas fa-football-ball"></span>  GP</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/cfbfastR"><span class="fa fab fa-twitter fa-lg"></span> </a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sportsdataverse/cfbfastR/"><span class="fa fab fa-github fa-lg"></span> </a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Rolling EPA Graph</h1>
                        <h4 data-toc-skip class="author">Nate Manzo
<br><a href="https://twitter.com/cfbnate" target="blank" class="external-link"><img src="https://img.shields.io/twitter/follow/cfbnate?color=blue&amp;label=%40cfbnate&amp;logo=X&amp;style=for-the-badge" alt="@cfbnate"></a>
<a href="https://github.com/natemanzo" target="blank" class="external-link"><img src="https://img.shields.io/github/followers/natemanzo?color=eee&amp;logo=Github&amp;style=for-the-badge" alt="@natemanzo"></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sportsdataverse/cfbfastR/blob/main/vignettes/rolling-epa-graph.rmd" class="external-link"><code>vignettes/rolling-epa-graph.rmd</code></a></small>
      <div class="d-none name"><code>rolling-epa-graph.rmd</code></div>
    </div>

    
    
<p>This vignette will use data from the <code>cfbfastR</code> package to
create a moving average graph of offensive EPA over the course of a
season. This lets us visualize how a team’s performance has changed over
time and compare that performance to other teams around the country.</p>
<div class="section level2">
<h2 id="load-and-install-the-necessary-packages">Load and Install the necessary packages<a class="anchor" aria-label="anchor" href="#load-and-install-the-necessary-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">'pacman'</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'pacman'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">tidyverse</span>, <span class="va">zoo</span>, <span class="va">ggimage</span>, <span class="va">cfbfastR</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pull-the-play-by-play-data">Pull the play by play data<a class="anchor" aria-label="anchor" href="#pull-the-play-by-play-data"></a>
</h2>
<p>Using the <a href="https://saiemgilani.github.io/cfbfastR/reference/load_cfb_pbp.html" class="external-link">load_cfb_pbp()</a>
method, we will pull down a dataframe that contains ALL of the play by
play data for ALL teams in 2025. This method only takes about 30
seconds.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yr</span> <span class="op">&lt;-</span> <span class="fu">cfbfastR</span><span class="fu">:::</span><span class="fu">most_recent_cfb_season</span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span></span>
<span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">cfbfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_cfb_pbp.html">load_cfb_pbp</a></span><span class="op">(</span><span class="va">yr</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pull-team-info-and-team-colors">Pull team info and team colors<a class="anchor" aria-label="anchor" href="#pull-team-info-and-team-colors"></a>
</h2>
<p>We can use the <code><a href="../reference/cfbd_team_info.html">cfbd_team_info()</a></code> function to pull
information about each FBS school including their logo, color, and
abbreviation. We’re going to take a subset of the cfb_team_info data and
clean it up for use in our graphs later on.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_info</span> <span class="op">=</span> <span class="fu">cfbfastR</span><span class="fu">::</span><span class="fu"><a href="../reference/cfbd_team_info.html">cfbd_team_info</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">yr</span>, only_fbs <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">team_colors_logos</span> <span class="op">=</span> <span class="va">team_info</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">school</span>, <span class="va">abbreviation</span>, <span class="va">color</span>, <span class="va">logo</span>, <span class="va">alt_color</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">school</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-overview-of-all-fbs-offenses">Basic overview of all FBS Offenses<a class="anchor" aria-label="anchor" href="#basic-overview-of-all-fbs-offenses"></a>
</h2>
<p>Let’s create a basic overview of offensive EPA per play. We’ll start
by creating a dataframe listing all 130 FBS teams from best to worst
based on their average EPA per play across all games played.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">off_epa</span> <span class="op">=</span> <span class="va">pbp</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">offense_play</span>, <span class="va">offense_conference</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>off_epa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">EPA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">off_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>Team <span class="op">=</span> <span class="va">offense_play</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">offense_conference</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Rank <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>TeamRank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Team</span>, <span class="st">" #"</span>, <span class="va">Rank</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can use the <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> function to take a quick peak at
what our new dataframe looks like. The teams at the top should not be
surprising. Remember, EPA is not adjusted for the strength of opponent.
It is purely a measure of how teams perform on the field (like yards,
but better).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">##   Team               offense_conference off_epa  Rank TeamRank             </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Miami              ACC                  0.286     1 Miami #1             </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Eastern Washington Big Sky              0.262     2 Eastern Washington #2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Monmouth           CAA                  0.258     3 Monmouth #3          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> South Dakota       MVFC                 0.247     4 South Dakota #4      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Montana State      Big Sky              0.233     5 Montana State #5     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Ohio State         Big Ten              0.217     6 Ohio State #6</span></span></code></pre>
<p>Ok, now let’s start to visualize the data beyond the top few schools.
Let’s graph all the teams that have a positive EPA on the year.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">off_epa</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">off_epa</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">TeamRank</span>, <span class="va">off_epa</span><span class="op">)</span>, y<span class="op">=</span><span class="va">off_epa</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Average EPA Per Play"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Offensive EPA Per Play | Positive EPA Teams"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Chart by @cfbNate</span></span>
<span><span class="st">       Data from @CFB_Data via @cfbfastr"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="rolling-epa-graph_files/figure-html/graph_top_offenses-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="prepare-the-data-for-the-moving-average-chart">Prepare the data for the moving average chart<a class="anchor" aria-label="anchor" href="#prepare-the-data-for-the-moving-average-chart"></a>
</h2>
<p>So far, so good, but we came here to build a moving average chart!
Let’s proceed by defining the team of interest and the moving average
window by editing the cell block below. I like to use 100 plays when
looking at a full season to smooth out as much of the variability as
possible, but for a mid-season view 50 plays or even 25 plays might be
more appropriate. Play around!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team</span> <span class="op">=</span> <span class="st">"Oklahoma"</span></span>
<span><span class="va">ma_plays</span> <span class="op">=</span> <span class="fl">100</span></span></code></pre></div>
<p>Now that we have defined our team of interest, we can prepare the
data for this specific team. We’re going to create a dataframe called
<code>team_off</code> that is subsetted from our full season play by
play data. This new dataframe will be specific to our team of interest
and it will add fields for the moving average and the play count.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_off</span> <span class="op">=</span> <span class="va">pbp</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">offense_play</span> <span class="op">==</span> <span class="va">team</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">pass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">EPA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>cu_epa<span class="op">=</span><span class="fu">cummean</span><span class="op">(</span><span class="va">EPA</span><span class="op">)</span>,  <span class="co">#this field is not used in this vignette but it could be substituted later to graph the cumulative EPA</span></span>
<span>         ma_epa<span class="op">=</span><span class="fu">rollapply</span><span class="op">(</span><span class="va">EPA</span>,<span class="va">ma_plays</span>,<span class="va">mean</span>,align<span class="op">=</span><span class="st">'right'</span>,fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>         play_count <span class="op">=</span> <span class="fu">row_number</span><span class="op">(</span><span class="op">)</span>,</span>
<span>         week_team <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"WK"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">week</span> <span class="op">&gt;</span> <span class="fl">9</span>, <span class="va">week</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">week</span><span class="op">)</span><span class="op">)</span>, <span class="st">" "</span>, <span class="va">defense_play</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We’re going to graph different background tiles for each opponent so
we need to define where one opponent stops and another one begins.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_off_play_start</span> <span class="op">=</span> <span class="va">team_off</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">week_team</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">defense_play</span>, <span class="va">week_team</span>, <span class="va">play_count</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>play_start <span class="op">=</span> <span class="va">play_count</span>,</span>
<span>         team <span class="op">=</span> <span class="va">defense_play</span><span class="op">)</span></span>
<span></span>
<span><span class="va">team_off_play_stop</span> <span class="op">=</span> <span class="va">team_off</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">week_team</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">week_team</span>, <span class="va">play_count</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>play_stop <span class="op">=</span> <span class="va">play_count</span><span class="op">)</span></span></code></pre></div>
<p>We’re going to add the opponent’s logo in the middle of each
background tile, so we need to define the midpoint of each background
tile as well.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_off_start_stop</span> <span class="op">=</span> <span class="va">team_off_play_start</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_off_play_stop</span>, by <span class="op">=</span> <span class="st">"week_team"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>midpoint <span class="op">=</span> <span class="op">(</span><span class="va">play_start</span> <span class="op">+</span> <span class="va">play_stop</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>We need to make a simple vector that says how many total plays are in
our <code>team_off</code> dataframe.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">play_count</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">team_off</span><span class="op">$</span><span class="va">play_count</span><span class="op">)</span></span></code></pre></div>
<p>Next we are going to update our background tile dataframe to include
the color info that we pulled earlier. FCS color data is not available,
so we will default those to gray.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_off_start_stop</span> <span class="op">=</span> <span class="va">team_off_start_stop</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">team_colors_logos</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"school"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>color <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">color</span>,<span class="st">"gray"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">team</span>, <span class="va">week_team</span>, <span class="va">play_start</span>, <span class="va">play_stop</span>, <span class="va">midpoint</span>, <span class="va">color</span><span class="op">)</span></span></code></pre></div>
<p>Are we ready to graph yet? Just a few more steps! We need a named
vector to get the right colors on those background tiles.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">team_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">team_off_start_stop</span><span class="op">$</span><span class="va">color</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">team_colors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">team_off_start_stop</span><span class="op">$</span><span class="va">team</span><span class="op">)</span></span></code></pre></div>
<p>Now we need to pull in an alternate source of team logos that
includes FCS schools. Then we’ll join that new table of logos with our
background tile dataframe.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_logos</span> <span class="op">=</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/natemanzo/cfb_data/master/_team_logos.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">team_off_start_stop</span> <span class="op">=</span> <span class="va">team_off_start_stop</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">all_logos</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"school"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Almost done! The last thing we need is your signature to go in the
caption of the graph. You can use your twitter handle or your real name
here.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">signature</span> <span class="op">=</span> <span class="st">"@cfbNate"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="its-graphin-time">IT’S GRAPHIN’ TIME*<a class="anchor" aria-label="anchor" href="#its-graphin-time"></a>
</h2>
<p><sup>*To be said in an extremely Power Rangers voice</sup></p>
<p>The beginning of the line graph will depend on the
<code>ma_plays</code> variable that you defined earlier. Dashed lines
indicating the EPA/play of the 25th percentile, median, 75th percentile,
and top and bottom teams in the country are drawn on the graph to show
context for how the team of interest compares to the rest of the
country.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph_team_off</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off_start_stop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">play_start</span>, xmax <span class="op">=</span> <span class="va">play_stop</span>, fill <span class="op">=</span> <span class="va">team</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">.5</span>, ymax <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray90"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off_start_stop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">play_start</span>, xmax <span class="op">=</span> <span class="va">play_stop</span>, ymin <span class="op">=</span> <span class="fl">.8</span>, ymax <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray90"</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">team_colors</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"gray20"</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"gray20"</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_image</span><span class="op">(</span>data<span class="op">=</span><span class="va">team_off_start_stop</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">midpoint</span>,y<span class="op">=</span><span class="fl">.9</span>,image<span class="op">=</span><span class="va">logo</span><span class="op">)</span>, asp <span class="op">=</span> <span class="fl">16</span><span class="op">/</span><span class="fl">9</span>, size <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="va">off_epa</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">Team</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="st">"25%ile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="st">"Median"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="st">"75%ile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">off_epa</span><span class="op">$</span><span class="va">off_epa</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, geom <span class="op">=</span> <span class="st">"text"</span>, size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span>, vjust <span class="op">=</span> <span class="fl">0</span>, label <span class="op">=</span> <span class="va">off_epa</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">pull</span><span class="op">(</span><span class="va">Team</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">play_count</span>, y <span class="op">=</span> <span class="va">ma_epa</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">team_off</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">play_count</span>, y <span class="op">=</span> <span class="va">ma_epa</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"EPA"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Number of Plays"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">team</span>,<span class="st">" Offensive EPA | "</span>,<span class="va">ma_plays</span>,<span class="st">"-Play Moving Average"</span><span class="op">)</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Chart by "</span>,<span class="va">signature</span>,<span class="st">" using code from @cfbNate</span></span>
<span><span class="st">       Data from @CFB_Data via @cfbfastR"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="va">play_count</span><span class="op">)</span>,  <span class="co"># This leaves room for the labels over the dashed lines</span></span>
<span>                  clip <span class="op">=</span> <span class="st">'off'</span><span class="op">)</span>               <span class="co"># This keeps the labels from disappearing</span></span>
<span></span>
<span><span class="va">graph_team_off</span></span></code></pre></div>
<p><img src="rolling-epa-graph_files/figure-html/graph_the_graph-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Lastly, you can save your graph to your working directory by running
the line below. PC users will notice the saved graphic will have a
higher resolution and less pixelization than the graphic generated
above.</p>
<p>Reminder: You can always use <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> to find out what
your current working directory is if you’re not sure.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">graph_team_off</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"off_epa_rolling_"</span>,<span class="va">team</span>,<span class="st">".png"</span><span class="op">)</span>, </span>
<span>       dpi <span class="op">=</span> <span class="fl">300</span>, type <span class="op">=</span> <span class="st">"cairo"</span>, width <span class="op">=</span> <span class="fl">10</span>, height <span class="op">=</span> <span class="fl">7</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code></pre></div>
<p>I hope you found this useful! As always, thanks to <a href="https://twitter.com/CFB_Data" class="external-link">@CFB_Data</a> and the <a href="https://twitter.com/cfbfastR" class="external-link">@cfbfastR</a> team for making this
possible. And shout out to folks like Parker Fleming (<a href="https://twitter.com/statsowar" class="external-link">@statsowar</a>) and Meyappan
Subbaiah (<a href="https://twitter.com/msubbiah1" class="external-link">@msubbiah1</a>) for
their feedback, advice, and encouragement while refining the look of
this visualization. Tag me in any of these graphs you post on twitter
and I’ll share them as much as possible.</p>
<p>-<a href="https://twitter.com/cfbNate" class="external-link">Nate Manzo</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://twitter.com/saiemgilani" class="external-link">Saiem Gilani</a>, <a href="https://twitter.com/akeaswaran" class="external-link">Akshay Easwaran</a>, <a href="https://twitter.com/JaredDLee" class="external-link">Jared Lee</a>, <a href="https://twitter.com/arbitanalytics" class="external-link">Eric Hess</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
